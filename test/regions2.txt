// Regression test for Jonathan's pinning simulations

d := 3.125e-9
h := 5e-9

SetGridsize(64, 64, 2)
SetCellsize(d, d, h)

setgeom( cylinder(190e-9, 190e-9).transl(0.5*d,0.5*d,0) )

Msat  = 860e3
Aex   = 13e-12

defregion(2, cuboid(3*d,3*d,h).transl(0.5*d,0.5*d,0.5*h))


Msat.setregion(2, 0.0)

les := sqrt(2*13e-12/860e3)
setlexchange(1,2, les)

alpha = 0.8

m = vortex(1, -1).transl(5e-9, 0, 0)

run(1e-9)


m_ := average(m)
expect("m", m_[0], -0.00459366664290, 1e-6)
expect("m", m_[1],  0.00020866186241, 1e-6)
expect("m", m_[2], -0.00556917348876, 1e-6)
